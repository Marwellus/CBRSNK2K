#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "inc/font.hpp"

Font::Font(char *filename) {
	Load(filename);

	char tmp[10][8] = {
		{0x1e, 0x21, 0x21, 0x21, 0x1e, 0x0, 0x0, 0x0},
		{0x08, 0x18, 0x08, 0x08, 0x1c, 0x0, 0x0, 0x0},
		{0x1e, 0x01, 0x1e, 0x20, 0x0f, 0x0, 0x0, 0x0},
		{0x1e, 0x01, 0x0e, 0x01, 0x1e, 0x0, 0x0, 0x0},
		{0x02, 0x06, 0x0a, 0x1f, 0x02, 0x0, 0x0, 0x0},
		{0x1f, 0x20, 0x1e, 0x01, 0x1e, 0x0, 0x0, 0x0},
		{0x1e, 0x20, 0x1e, 0x21, 0x1e, 0x0, 0x0, 0x0},
		{0x1f, 0x01, 0x02, 0x04, 0x08, 0x0, 0x0, 0x0},
		{0x1e, 0x21, 0x1e, 0x21, 0x1e, 0x0, 0x0, 0x0},
		{0x1e, 0x21, 0x1f, 0x01, 0x1e, 0x0, 0x0, 0x0},
	};

	for (int r = 0; r < 10; r++) {
		for (int c = 0; c < 8; c++) {
			Micro[r][c] = tmp[r][c];
		}
	}
}

int Font::Load(char *filename) {
	char filepath[256] = "assets\\";
	strcat(filepath, filename);

	FILE *file;
	long filesize;

	file = fopen(filepath, "rb");
	if (!file) {
		printf("\nFont file not found!");
		return -1;
	}

	fseek(file, 0, SEEK_END);
	filesize = ftell(file);
	rewind(file);

	char *buffer = (char *)malloc(filesize);
	if (!buffer) {
		printf("\nNo font buffer allocated!");
		fclose(file);
		return -2;
	}

	fread(buffer, 1, filesize, file);
	fclose(file);

	createTable(buffer);

	free(buffer);

	return 1;
}

void Font::createTable(char *buffer) {
	for (int r = 0; r < 256; r++) {
		for (int c = 0; c < 8; c++) {
			int idx = r * 8 + c;
			Table[r][c] = buffer[idx];
		}
	}
}